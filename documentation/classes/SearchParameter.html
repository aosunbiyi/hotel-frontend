<!doctype html>
<html class="no-js" lang="">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="x-ua-compatible" content="ie=edge">
        <title>hotel-app documentation</title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <link rel="icon" type="image/x-icon" href="../images/favicon.ico">
	      <link rel="stylesheet" href="../styles/style.css">
    </head>
    <body>

        <div class="navbar navbar-default navbar-fixed-top visible-xs">
            <a href="../" class="navbar-brand">hotel-app documentation</a>
            <button type="button" class="btn btn-default btn-menu ion-ios-menu" id="btn-menu"></button>
        </div>

        <div class="xs-menu menu" id="mobile-menu">
                <div id="book-search-input" role="search"><input type="text" placeholder="Type to search"></div>            <compodoc-menu></compodoc-menu>
        </div>

        <div class="container-fluid main">
           <div class="row main">
               <div class="hidden-xs menu">
                   <compodoc-menu mode="normal"></compodoc-menu>
               </div>
               <!-- START CONTENT -->
               <div class="content class">
                   <div class="content-data">











<ol class="breadcrumb">
  <li>Classes</li>
  <li>SearchParameter</li>
</ol>

<ul class="nav nav-tabs" role="tablist">
        <li class="active">
            <a href="#info" role="tab" id="info-tab" data-toggle="tab" data-link="info">Info</a>
        </li>
        <li >
            <a href="#source" role="tab" id="source-tab" data-toggle="tab" data-link="source">Source</a>
        </li>
</ul>

<div class="tab-content">
    <div class="tab-pane fade active in" id="c-info">
        <p class="comment">
            <h3>File</h3>
        </p>
        <p class="comment">
            <code>src/app/Components/front-office/checkin/checkin.component.ts</code>
        </p>





            <section>
    <h3 id="index">Index</h3>
    <table class="table table-sm table-bordered index-table">
        <tbody>
                <tr>
                    <td class="col-md-4">
                        <h6><b>Properties</b></h6>
                    </td>
                </tr>
                <tr>
                    <td class="col-md-4">
                        <ul class="index-list">
                            <li>
                                    <span class="modifier">Public</span>
                                <a href="#Condition">Condition</a>
                            </li>
                            <li>
                                    <span class="modifier">Public</span>
                                <a href="#Field">Field</a>
                            </li>
                            <li>
                                    <span class="modifier">Public</span>
                                <a href="#Value">Value</a>
                            </li>
                        </ul>
                    </td>
                </tr>






        </tbody>
    </table>
</section>


            <section>
    
        <h3 id="inputs">
            Properties
        </h3>
        <table class="table table-sm table-bordered">
            <tbody>
                <tr>
                    <td class="col-md-4">
                        <a name="Condition"></a>
                        <span class="name">
                            <b>
                                <span class="modifier">Public</span>
                            Condition
                            </b>
                            <a href="#Condition"><span class="icon ion-ios-link"></span></a>
                        </span>
                    </td>
                </tr>
                <tr>
                    <td class="col-md-4">
                        <span class="modifier-icon icon ion-ios-reset"></span><code>Condition:     <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String" target="_blank" >String</a></code>
</code>
                    </td>
                </tr>
                    <tr>
                        <td class="col-md-4">
                            <i>Type : </i>    <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String" target="_blank" >String</a></code>

                        </td>
                    </tr>
                        <tr>
                            <td class="col-md-4">
                                    <div class="io-line">Defined in <a href="" data-line="409" class="link-to-prism">src/app/Components/front-office/checkin/checkin.component.ts:409</a></div>
                            </td>
                        </tr>


            </tbody>
        </table>
        <table class="table table-sm table-bordered">
            <tbody>
                <tr>
                    <td class="col-md-4">
                        <a name="Field"></a>
                        <span class="name">
                            <b>
                                <span class="modifier">Public</span>
                            Field
                            </b>
                            <a href="#Field"><span class="icon ion-ios-link"></span></a>
                        </span>
                    </td>
                </tr>
                <tr>
                    <td class="col-md-4">
                        <span class="modifier-icon icon ion-ios-reset"></span><code>Field:     <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String" target="_blank" >String</a></code>
</code>
                    </td>
                </tr>
                    <tr>
                        <td class="col-md-4">
                            <i>Type : </i>    <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String" target="_blank" >String</a></code>

                        </td>
                    </tr>
                        <tr>
                            <td class="col-md-4">
                                    <div class="io-line">Defined in <a href="" data-line="408" class="link-to-prism">src/app/Components/front-office/checkin/checkin.component.ts:408</a></div>
                            </td>
                        </tr>


            </tbody>
        </table>
        <table class="table table-sm table-bordered">
            <tbody>
                <tr>
                    <td class="col-md-4">
                        <a name="Value"></a>
                        <span class="name">
                            <b>
                                <span class="modifier">Public</span>
                            Value
                            </b>
                            <a href="#Value"><span class="icon ion-ios-link"></span></a>
                        </span>
                    </td>
                </tr>
                <tr>
                    <td class="col-md-4">
                        <span class="modifier-icon icon ion-ios-reset"></span><code>Value:     <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String" target="_blank" >String</a></code>
</code>
                    </td>
                </tr>
                    <tr>
                        <td class="col-md-4">
                            <i>Type : </i>    <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String" target="_blank" >String</a></code>

                        </td>
                    </tr>
                        <tr>
                            <td class="col-md-4">
                                    <div class="io-line">Defined in <a href="" data-line="410" class="link-to-prism">src/app/Components/front-office/checkin/checkin.component.ts:410</a></div>
                            </td>
                        </tr>


            </tbody>
        </table>
</section>







    </div>


    <div class="tab-pane fade  tab-source-code" id="c-source">
        <pre class="line-numbers compodoc-sourcecode"><code class="language-typescript">import { Component, OnInit, ElementRef, ViewChild, ChangeDetectionStrategy, ChangeDetectorRef, Renderer } from &#x27;@angular/core&#x27;;
import { ClrWizard, ClrForm, ClrWizardPage } from &#x27;@clr/angular&#x27;;
import { FormGroup, FormControl, Validators, FormBuilder } from &#x27;@angular/forms&#x27;;
import { LocalDate, LocalTime } from &#x27;js-joda&#x27;;
import * as lodash from &#x27;lodash&#x27;;
import { ReservationsService } from &#x27;../../../services/reservations.service&#x27;;
import { AccountsService } from &#x27;../../../services/accounts.service&#x27;;
import { DiscountService } from &#x27;../../../services/discount.service&#x27;;

@Component({
  selector: &#x27;app-checkin&#x27;,
  templateUrl: &#x27;./checkin.component.html&#x27;,
  styleUrls: [&#x27;./checkin.component.css&#x27;],
  changeDetection: ChangeDetectionStrategy.OnPush
})
export class CheckinComponent implements OnInit {
  @ViewChild(&#x27;wizardxl&#x27;) wizardExtraLarge: ClrWizard;
  @ViewChild(&#x27;page1&#x27;) page1: ClrWizardPage;
  criteriaList &#x3D; [];
  inputType &#x3D; &#x27;text&#x27;;
  optionList: SearchParameter[] &#x3D; [];
  reservations &#x3D; [];
  open_wizard &#x3D; false;
  selectedReservation &#x3D; { accounts_: null, account_id: 0, reserved_rooms: [], id: 0 };
  loadingAccount &#x3D; false;
  account_list &#x3D; [];
  selected_account;
  transfer_mode &#x3D; false;
  search_data;
  paymentForm: FormGroup;
  isCheque &#x3D; false;
  applyDiscount &#x3D; false;
  discountList &#x3D; [];


  constructor(private elementRef: ElementRef,
    private reservationsService: ReservationsService,
    private accountService: AccountsService,
    private formBuilder: FormBuilder,
    private cd: ChangeDetectorRef,
    public renderer: Renderer,
    private discountService: DiscountService) { }

  ngOnInit() {
    this.accountService.getAccounts().subscribe(data &#x3D;&gt; {
      this.account_list &#x3D; data;
      this.account_list.forEach(ac &#x3D;&gt; {
        ac.fullname &#x3D; ac.first_name + &#x27; &#x27; + ac.last_name;
      });
    });

    this.paymentForm &#x3D; this.formBuilder.group({
      payment_method: [&#x27;&#x27;, Validators.required],
      total_amount: [&#x27;&#x27;, Validators.required],
      amount: [&#x27;&#x27;, Validators.required],
      balance: [&#x27;&#x27;],
      cheque: [&#x27;&#x27;],
      account_number: [&#x27;&#x27;],
      bank_name: [&#x27;&#x27;],
      branch_name: [&#x27;&#x27;],
      discount_plan: [&#x27;&#x27;],
      discount_value: [&#x27;&#x27;],
      discount_code: [&#x27;&#x27;],
      apply_discount: [&#x27;&#x27;]
    });


    this.discountService.getDiscounts().subscribe(data &#x3D;&gt; {
      this.discountList &#x3D; data;
    });



  }

  addCriterion(event) {
    this.criteriaList.push(1);
  }

  removeLast(event) {
    this.criteriaList.pop();
  }

  onSearchFieldChange(event) {
    const v &#x3D; event.target.value;
    if (v &#x3D;&#x3D;&#x3D; &#x27;select&#x27;) {
      this.inputType &#x3D; &#x27;text&#x27;;
      return;
    }
    const t1 &#x3D; v.toString().split(&#x27;|&#x27;)[0];
    const t2 &#x3D; v.toString().split(&#x27;|&#x27;)[1];
    this.elementRef.nativeElement.querySelector(&#x27;.vv0&#x27;).type &#x3D; t2;
  }

  onReservationSearch(event) {
    this.optionList &#x3D; [];
    const field1: string &#x3D; this.elementRef.nativeElement.querySelector(&#x27;.ss0&#x27;).value;
    const field2: string &#x3D; this.elementRef.nativeElement.querySelector(&#x27;.cc0&#x27;).value;
    const field3: string &#x3D; this.elementRef.nativeElement.querySelector(&#x27;.vv0&#x27;).value;

    if (field1 &#x3D;&#x3D;&#x3D; &#x27;&#x27; || field1.toString().length &lt;&#x3D; 0 || field1 &#x3D;&#x3D;&#x3D; &#x27;select&#x27;) {
      alert(&#x27;Search Field cannot be empty!&#x27;);
      return;
    }

    if (field2 &#x3D;&#x3D;&#x3D; &#x27;&#x27; || field2.toString().length &lt;&#x3D; 0) {
      alert(&#x27;Search Condition cannot be empty!&#x27;);
      return;
    }

    if (field3 &#x3D;&#x3D;&#x3D; &#x27;&#x27; || field3.toString().length &lt;&#x3D; 0) {
      alert(&#x27;Search Value cannot be empty!&#x27;);
      return;
    }
    const param: SearchParameter &#x3D; new SearchParameter();
    param.Field &#x3D; field1;
    param.Condition &#x3D; field2;
    param.Value &#x3D; field3;
    this.optionList.push(param);

    let i &#x3D; 0;
    for (i &#x3D; 0; i &lt; this.criteriaList.length; i++) {
      const field: string &#x3D; this.elementRef.nativeElement.querySelector(&#x27;.s&#x27; + i.toString()).value;
      const condition: string &#x3D; this.elementRef.nativeElement.querySelector(&#x27;.c&#x27; + i.toString()).value;
      const value: string &#x3D; this.elementRef.nativeElement.querySelector(&#x27;.v&#x27; + i.toString()).value;

      if (field &#x3D;&#x3D;&#x3D; &#x27;&#x27; || field1.toString().length &lt;&#x3D; 0 || field1 &#x3D;&#x3D;&#x3D; &#x27;select&#x27;) {
        continue;
      }

      if (condition &#x3D;&#x3D;&#x3D; &#x27;&#x27; || field2.toString().length &lt;&#x3D; 0) {
        continue;
      }

      if (value &#x3D;&#x3D;&#x3D; &#x27;&#x27; || field3.toString().length &lt;&#x3D; 0) {
        continue;
      }

      const param2: SearchParameter &#x3D; new SearchParameter();
      param2.Field &#x3D; field;
      param2.Condition &#x3D; condition;
      param2.Value &#x3D; value;
      this.optionList.push(param2);


    }
    this.search_data &#x3D; this.optionList;
    this.reservationsService.searchReservationWithParam(this.optionList).subscribe(data &#x3D;&gt; {
      this.reservations &#x3D; data;
      console.log(data);
    });

  }


  onSearchFieldChange2(event) {
    const v &#x3D; event.target.value;
    if (v &#x3D;&#x3D;&#x3D; &#x27;select&#x27;) {
      this.inputType &#x3D; &#x27;text&#x27;;
      return;
    }
    const t1 &#x3D; v.toString().split(&#x27;|&#x27;)[0];
    const t2 &#x3D; v.toString().split(&#x27;|&#x27;)[1];
    const count &#x3D; v.toString().split(&#x27;|&#x27;)[2];
    this.elementRef.nativeElement.querySelector(&#x27;.v&#x27; + count.toString()).type &#x3D; t2;
    this.refresh();
  }

  onCheckInClicked(reservation) {

    this.paymentForm.setValue({
      payment_method: &#x27;&#x27;,
      total_amount: reservation.balance,
      amount: 0,
      balance: 0,
      cheque: &#x27;&#x27;,
      account_number: &#x27;&#x27;,
      bank_name: &#x27;&#x27;,
      branch_name: &#x27;&#x27;,
      discount_plan: 0,
      discount_value: 0,
      discount_code: &#x27;&#x27;,
      apply_discount: false
    });

    const vm &#x3D; this;
    this.selectedReservation &#x3D; reservation;
    vm.selectedReservation.accounts_ &#x3D; null;
    this.loadingAccount &#x3D; true;
    this.open_wizard &#x3D; true;
    console.log(reservation);
    setTimeout(() &#x3D;&gt; {
      this.accountService.getAccountById(this.selectedReservation.account_id).subscribe(data &#x3D;&gt; {
        vm.selectedReservation.accounts_ &#x3D; data;
        console.log(data);
        vm.loadingAccount &#x3D; false;
        this.refresh();
      });
    }, 1000);


  }

  onRoomOwnerChanged(event, room) {
    // console.log(event, room, this.selected_account);
    const transferData &#x3D; {
      reserved_room_id: room.id,
      new_account_id: this.selected_account
    };
    this.reservationsService.transfer_room(transferData).subscribe(data &#x3D;&gt; {
      delete room.transfer_mode;
      this.reservationsService.searchReservationWithParam(this.optionList).subscribe(dd &#x3D;&gt; {
        this.reservations &#x3D; dd;
      });
    });
  }

  onDeleteReservation(id) {
    this.reservationsService.delete_reserved_room(id).subscribe(data &#x3D;&gt; {
      console.log(data);
      this.reservationsService.searchReservationWithParam(this.optionList).subscribe(dd &#x3D;&gt; {
        this.reservations &#x3D; dd;
      });
    });
  }

  onTransferMode(room) {
    room.transfer_mode &#x3D; true;
  }

  onNumberOfChildChange(event, room) {
    const reservation_id &#x3D; room.reservation_id;
    const reserved_room_id &#x3D; room.id;
    const change_value &#x3D; event.target.value;
    const type &#x3D; &#x27;child&#x27;;

    const editData &#x3D; {
      reservation_id: reservation_id,
      reserved_room_id: reserved_room_id,
      change_value: change_value,
      type: type
    };

    this.reservationsService.edit_reserved_room(editData).subscribe(data &#x3D;&gt; {
      this.selectedReservation &#x3D; data;
    });
  }

  onNumberOfAdultChange(event, room) {
    const reservation_id &#x3D; room.reservation_id;
    const reserved_room_id &#x3D; room.id;
    const change_value &#x3D; event.target.value;
    const type &#x3D; &#x27;adult&#x27;;

    const editData &#x3D; {
      reservation_id: reservation_id,
      reserved_room_id: reserved_room_id,
      change_value: change_value,
      type: type
    };

    this.reservationsService.edit_reserved_room(editData).subscribe(data &#x3D;&gt; {
      this.selectedReservation &#x3D; data;
      console.log(data);
    });
  }

  onEditReserved_Room(room) {
    console.log(room);
    // tslint:disable-next-line:no-unused-expression
    this.elementRef.nativeElement.querySelector(&#x27;.r&#x27; + room.id).readOnly &#x3D; false;
    this.elementRef.nativeElement.querySelector(&#x27;.rr&#x27; + room.id).readOnly &#x3D; false;
  }

  onFinish() {
    this.wizardExtraLarge.navService.setCurrentPage(this.page1);
    this.open_wizard &#x3D; false;
    this.transfer_mode &#x3D; false;

    const data &#x3D; {
      reservation_id: this.selectedReservation.id,
      paymentForm: this.paymentForm.value
    };

    this.reservationsService.post_reservation_payment(data).subscribe(r &#x3D;&gt; {
      console.log(r);
      this.reservationsService.getReservations().subscribe(data2 &#x3D;&gt; {
        this.wizardExtraLarge.navService.setCurrentPage(this.page1);
        this.open_wizard &#x3D; false;
      });

    });


  }

  getTotalReservation400(reservation_transaction: any) {
    const output &#x3D; lodash(reservation_transaction)
      .groupBy(&#x27;reservation_id&#x27;)
      .map((objs, key) &#x3D;&gt; ({
        &#x27;reservation_id&#x27;: key,
        &#x27;total&#x27;: lodash.sumBy(objs, &#x27;total&#x27;)
      }))
      .value();

    return output;
  }

  refresh() {
    this.cd.detectChanges();
  }

  public doCustomClick(buttonType: string): void {
    if (&#x27;custom-finish&#x27; &#x3D;&#x3D;&#x3D; buttonType) {
      this.wizardExtraLarge.next();
    }

    if (&#x27;custom-previous&#x27; &#x3D;&#x3D;&#x3D; buttonType) {
      this.wizardExtraLarge.previous();
    }

    if (&#x27;custom-danger&#x27; &#x3D;&#x3D;&#x3D; buttonType) {
      this.onFinish();
      console.log(this.paymentForm.value);
    }
  }

  onPaymentMethodChange(event) {
    if (event.target.value &#x3D;&#x3D;&#x3D; &#x27;Cheque&#x27;) {
      this.isCheque &#x3D; true;
    } else {
      this.isCheque &#x3D; false;
    }
  }


  onDiscountChange(event) {
    this.applyDiscount &#x3D; event.target.checked;
    this.paymentForm.setValue({
      payment_method: this.paymentForm.value.payment_method,
      total_amount: this.paymentForm.value.total_amount,
      amount: this.paymentForm.value.amount,
      balance: this.paymentForm.value.balance,
      cheque: &#x27;&#x27;,
      account_number: &#x27;&#x27;,
      bank_name: &#x27;&#x27;,
      branch_name: &#x27;&#x27;,
      discount_plan: 0,
      discount_value: 0,
      discount_code: &#x27;&#x27;,
      apply_discount: this.applyDiscount
    });

  }

  onAmountLeave(value: string) {
    const amount &#x3D; parseFloat(value);
    const total &#x3D; this.paymentForm.value.total_amount;
    const balance &#x3D; total - amount;

    this.paymentForm.setValue({
      payment_method: this.paymentForm.value.payment_method,
      total_amount: this.paymentForm.value.total_amount,
      amount: amount,
      balance: balance,
      cheque: &#x27;&#x27;,
      account_number: &#x27;&#x27;,
      bank_name: &#x27;&#x27;,
      branch_name: &#x27;&#x27;,
      discount_plan: 0,
      discount_value: 0,
      discount_code: &#x27;&#x27;,
      apply_discount: this.applyDiscount
    });

  }

  getDiscountStatus(onDiscount, sl) {
    if (onDiscount &#x3D;&#x3D;&#x3D; 1) {
      return &#x27;&lt;a  class&#x3D;&quot;label label-purple clickable&quot;&gt;Yes&lt;span class&#x3D;&quot;badge&quot;&gt;&#x27; + sl.discount_amount + &#x27;&lt;/span&gt;&lt;/a&gt;&#x27;;
    } else {
      return &#x27;&lt;span class&#x3D;&quot;label label-warning&quot;&gt;No&lt;/span&gt;&#x27;;
    }
  }

  getReservationStatus(status) {

    if (status &#x3D;&#x3D;&#x3D; &#x27;Open&#x27;) {
      return &#x27;&lt;span class&#x3D;&quot;label label-success&quot;&gt;Open&lt;/span&gt;&#x27;;
    } else {
      return &#x27;&lt;span class&#x3D;&quot;label label-info&quot;&gt;Close&lt;/span&gt;&#x27;;
    }
  }


  checkPaymentVisibility(status) {
    if (status &#x3D;&#x3D;&#x3D; &#x27;Completed&#x27;) {
      return true;
    } else {
      return false;
    }
  }


}

class SearchParameter {
  public Field: String;
  public Condition: String;
  public Value: String;
}


</code></pre>
    </div>
</div>







                   </div><div class="search-results">
    <div class="has-results">
        <h1 class="search-results-title"><span class='search-results-count'></span> result-matching "<span class='search-query'></span>"</h1>
        <ul class="search-results-list"></ul>
    </div>
    <div class="no-results">
        <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
    </div>
</div>
</div>
               <!-- END CONTENT -->
           </div>
       </div>

       <script>
            var COMPODOC_CURRENT_PAGE_DEPTH = 1;
            var COMPODOC_CURRENT_PAGE_CONTEXT = 'class';
            var COMPODOC_CURRENT_PAGE_URL = 'SearchParameter.html';
       </script>

       <script src="../js/libs/custom-elements.min.js"></script>
       <script src="../js/libs/lit-html.js"></script>
       <!-- Required to polyfill modern browsers as code is ES5 for IE... -->
       <script src="../js/libs/custom-elements-es5-adapter.js" charset="utf-8" defer></script>
       <script src="../js/menu-wc.js" defer></script>

       <script src="../js/libs/bootstrap-native.js"></script>

       <script src="../js/libs/es6-shim.min.js"></script>
       <script src="../js/libs/EventDispatcher.js"></script>
       <script src="../js/libs/promise.min.js"></script>
       <script src="../js/libs/zepto.min.js"></script>

       <script src="../js/compodoc.js"></script>

       <script src="../js/tabs.js"></script>
       <script src="../js/menu.js"></script>
       <script src="../js/libs/clipboard.min.js"></script>
       <script src="../js/libs/prism.js"></script>
       <script src="../js/sourceCode.js"></script>
          <script src="../js/search/search.js"></script>
          <script src="../js/search/lunr.min.js"></script>
          <script src="../js/search/search-lunr.js"></script>
          <script src="../js/search/search_index.js"></script>
       <script src="../js/lazy-load-graphs.js"></script>


    </body>
</html>
